<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Papers Daily</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #238636;
            --accent-orange: #f0883e;
            --accent-red: #da3633;
            --accent-purple: #a371f7;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        .app { display: flex; height: 100vh; }
        .main-panel { flex: 1; overflow-y: auto; padding: 20px 30px; }
        .side-panel {
            width: 380px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            padding: 20px;
        }
        .header { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .header h1 { font-size: 1.8em; margin-bottom: 5px; }
        .header-meta { color: var(--text-secondary); font-size: 0.9em; }
        .search-container { margin-bottom: 20px; }
        .search-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95em;
        }
        .search-input:focus { outline: none; border-color: var(--accent-blue); }
        .search-input::placeholder { color: var(--text-secondary); }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; gap: 6px; flex-wrap: wrap; flex: 1; }
        .filter-btn {
            padding: 6px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 0.8em;
            cursor: pointer;
        }
        .filter-btn:hover { background: var(--border); }
        .filter-btn.active { background: var(--accent-green); border-color: var(--accent-green); }
        .sort-select {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.85em;
        }
        .must-read-section {
            background: linear-gradient(135deg, #1a1f2e 0%, #161b22 100%);
            border: 1px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        .must-read-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .must-read-header h2 { font-size: 1.2em; color: var(--accent-orange); }
        .must-read-summary { color: var(--text-secondary); font-size: 0.9em; margin-bottom: 15px; line-height: 1.7; }
        .paper {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .paper:hover { border-color: var(--text-secondary); }
        .paper.must-read { border-left: 3px solid var(--accent-orange); }
        .paper.notable { border-left: 3px solid var(--accent-blue); }
        .paper-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; margin-bottom: 8px; }
        .paper-title { font-size: 1em; font-weight: 600; line-height: 1.4; }
        .paper-title a { color: var(--accent-blue); text-decoration: none; }
        .paper-title a:hover { text-decoration: underline; }
        .paper-score { flex-shrink: 0; padding: 4px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }
        .paper-score.high { background: var(--accent-green); color: white; }
        .paper-score.medium { background: var(--accent-blue); color: white; }
        .paper-score.low { background: var(--bg-tertiary); color: var(--text-secondary); }
        .paper-meta { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 10px; font-size: 0.8em; color: var(--text-secondary); }
        .paper-institution { color: var(--accent-purple); font-weight: 500; }
        .paper-date { color: var(--accent-orange); }
        .paper-citations { color: var(--accent-green); }
        .paper-contribution {
            font-size: 0.9em;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 6px;
            border-left: 2px solid var(--accent-blue);
        }
        .paper-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
        .tag {
            font-size: 0.7em;
            padding: 3px 10px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
        }
        .tag:hover { background: var(--border); color: var(--text-primary); }
        .tag.source { font-weight: 500; }
        .tag.source.arxiv { color: var(--accent-orange); border: 1px solid var(--accent-orange); }
        .tag.source.huggingface { color: #ff6b6b; border: 1px solid #ff6b6b; }
        .tag.source.paperswithcode { color: var(--accent-purple); border: 1px solid var(--accent-purple); }
        .paper-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .action-btn {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75em;
            cursor: pointer;
            text-decoration: none;
        }
        .action-btn:hover { background: var(--border); color: var(--text-primary); }
        .action-btn.save-btn.saved { background: var(--accent-green); border-color: var(--accent-green); color: white; }
        .action-btn.pdf-btn { border-color: var(--accent-red); color: var(--accent-red); }
        .paper-expandable { display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); }
        .paper-expandable.show { display: block; }
        .paper-abstract { font-size: 0.85em; color: var(--text-secondary); line-height: 1.7; }
        .prereq-list { list-style: none; }
        .prereq-list li { padding: 6px 0; border-bottom: 1px solid var(--bg-tertiary); font-size: 0.85em; }
        .prereq-name { color: var(--accent-orange); font-weight: 500; }
        .prereq-desc { color: var(--text-secondary); font-size: 0.9em; }
        .difficulty-badge { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.7em; text-transform: uppercase; font-weight: 600; color: white; }
        .difficulty-badge.beginner { background: var(--accent-green); }
        .difficulty-badge.intermediate { background: var(--accent-orange); }
        .difficulty-badge.advanced { background: var(--accent-red); }
        .difficulty-badge.expert { background: var(--accent-purple); }
        .side-section { margin-bottom: 25px; }
        .side-section h3 { font-size: 1em; margin-bottom: 12px; }
        .reading-list-empty { text-align: center; color: var(--text-secondary); padding: 30px; font-size: 0.9em; }
        .reading-list-item { padding: 10px; background: var(--bg-primary); border-radius: 6px; margin-bottom: 8px; font-size: 0.85em; }
        .reading-list-item a { color: var(--accent-blue); text-decoration: none; }
        .reading-list-item .remove-btn { float: right; background: none; border: none; color: var(--text-secondary); cursor: pointer; }
        .trend-item { padding: 10px; background: var(--bg-primary); border-radius: 6px; margin-bottom: 8px; }
        .trend-topic { font-weight: 600; color: var(--accent-orange); margin-bottom: 4px; }
        .trend-insight { font-size: 0.85em; color: var(--text-secondary); }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-card { background: var(--bg-primary); padding: 12px; border-radius: 6px; text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: 700; color: var(--accent-blue); }
        .stat-label { font-size: 0.75em; color: var(--text-secondary); }
        .institution-list { list-style: none; }
        .institution-list li { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--bg-tertiary); font-size: 0.85em; cursor: pointer; }
        .institution-name { color: var(--accent-purple); }
        .loading { text-align: center; padding: 60px; color: var(--text-secondary); }
        .shortcuts-hint { font-size: 0.75em; color: var(--text-secondary); text-align: center; padding: 10px; border-top: 1px solid var(--border); margin-top: 20px; }
        kbd { background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-family: monospace; }
        .count-badge { background: var(--bg-tertiary); padding: 2px 8px; border-radius: 10px; font-size: 0.75em; color: var(--text-secondary); }
        .no-results { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        @media (max-width: 1000px) {
            .app { flex-direction: column; }
            .side-panel { width: 100%; border-left: none; border-top: 1px solid var(--border); }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="main-panel">
            <div class="header">
                <h1>üî¨ AI Papers Daily</h1>
                <div class="header-meta" id="header-meta">Loading...</div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Search papers..." onkeyup="handleSearch(event)">
            </div>
            <div class="controls">
                <div class="filter-group" id="filters"></div>
                <select class="sort-select" id="sort-select" onchange="handleSort()">
                    <option value="score-desc">Best First</option>
                    <option value="date-desc">Newest</option>
                    <option value="date-asc">Oldest</option>
                    <option value="citations-desc">Most Cited</option>
                    <option value="upvotes-desc">Most Upvotes</option>
                    <option value="stars-desc">Most Stars</option>
                </select>
            </div>
            <div id="must-read-section"></div>
            <div id="papers-list"><div class="loading">Loading papers...</div></div>
        </div>
        <div class="side-panel">
            <div class="side-section">
                <h3>üìö Reading List <span class="count-badge" id="reading-count">0</span></h3>
                <div id="reading-list"><div class="reading-list-empty">Click Save to add papers</div></div>
                <button class="action-btn" style="width:100%;margin-top:10px;text-align:center" onclick="exportReadingList()">Export List</button>
            </div>
            <div class="side-section">
                <h3>üìä Stats</h3>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="stat-total">-</div><div class="stat-label">Papers</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-mustread">-</div><div class="stat-label">Must Read</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-code">-</div><div class="stat-label">With Code</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-notable">-</div><div class="stat-label">Notable</div></div>
                </div>
            </div>
            <div class="side-section">
                <h3>üî• Hot Topics</h3>
                <div id="trends-list"><div class="loading">Loading...</div></div>
            </div>
            <div class="side-section">
                <h3>üèõÔ∏è Institutions</h3>
                <ul class="institution-list" id="institution-list"></ul>
            </div>
            <div class="shortcuts-hint"><kbd>j</kbd>/<kbd>k</kbd> nav ¬∑ <kbd>o</kbd> open ¬∑ <kbd>s</kbd> save ¬∑ <kbd>/</kbd> search</div>
        </div>
    </div>
<script>
let allPapers=[], filteredPapers=[], summaryData={}, explanationsData={};
let readingList=JSON.parse(localStorage.getItem('aiPapersReadingList')||'[]');
let currentFilter='all', currentSort='score-desc', searchQuery='', selectedIndex=-1;

async function loadData(){
    try{
        const pr=await fetch('papers.json'); const pd=await pr.json(); allPapers=pd.papers||[];
        document.getElementById('header-meta').textContent=pd.date+' ¬∑ '+allPapers.length+' papers';
        const sr=await fetch('summary.json'); summaryData=await sr.json();
        try{const er=await fetch('explanations.json'); explanationsData=await er.json();}catch{}
        buildFilters(); updateStats(); renderTrends(); renderInstitutions(); renderReadingList(); applyFiltersAndRender();
    }catch(e){document.getElementById('papers-list').innerHTML='<div class="loading">Error: '+e.message+'</div>';}
}

function applyFiltersAndRender(){
    let papers=[...allPapers];
    if(searchQuery){const q=searchQuery.toLowerCase();papers=papers.filter(p=>p.title?.toLowerCase().includes(q)||p.authors?.toLowerCase().includes(q)||p.institution?.toLowerCase().includes(q)||p.abstract?.toLowerCase().includes(q));}
    if(currentFilter!=='all'){
        if(currentFilter==='must-read')papers=papers.filter(p=>p.score>=8);
        else if(currentFilter==='notable')papers=papers.filter(p=>p.score>=6&&p.score<8);
        else if(currentFilter==='has-code')papers=papers.filter(p=>p.github_url);
        else if(currentFilter==='saved')papers=papers.filter(p=>readingList.includes(p.id));
        else if(currentFilter.startsWith('source:'))papers=papers.filter(p=>p.source===currentFilter.replace('source:',''));
        else if(currentFilter.startsWith('inst:'))papers=papers.filter(p=>p.institution===currentFilter.replace('inst:',''));
        else papers=papers.filter(p=>p.tags?.includes(currentFilter));
    }
    papers=sortPapers(papers); filteredPapers=papers; renderPapers(); renderMustRead();
}

function sortPapers(papers){
    const s=[...papers];
    switch(currentSort){
        case'score-desc':s.sort((a,b)=>(b.score||0)-(a.score||0));break;
        case'date-desc':s.sort((a,b)=>(b.pubDateISO||'').localeCompare(a.pubDateISO||''));break;
        case'date-asc':s.sort((a,b)=>(a.pubDateISO||'').localeCompare(b.pubDateISO||''));break;
        case'citations-desc':s.sort((a,b)=>(b.citations||0)-(a.citations||0));break;
        case'upvotes-desc':s.sort((a,b)=>(b.upvotes||0)-(a.upvotes||0));break;
        case'stars-desc':s.sort((a,b)=>(b.github_stars||0)-(a.github_stars||0));break;
    }
    return s;
}

function handleSearch(e){searchQuery=e.target.value;applyFiltersAndRender();}
function handleSort(){currentSort=document.getElementById('sort-select').value;applyFiltersAndRender();}
function setFilter(f,btn){currentFilter=f;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');applyFiltersAndRender();}

function buildFilters(){
    const c=document.getElementById('filters');
    const counts={all:allPapers.length,'must-read':allPapers.filter(p=>p.score>=8).length,notable:allPapers.filter(p=>p.score>=6&&p.score<8).length,'has-code':allPapers.filter(p=>p.github_url).length,saved:readingList.length};
    const filters=[{key:'all',label:'All'},{key:'must-read',label:'üî• Must Read'},{key:'notable',label:'üìà Notable'},{key:'has-code',label:'üíª Code'},{key:'saved',label:'üìö Saved'}];
    c.innerHTML=filters.map(f=>'<button class="filter-btn '+(currentFilter===f.key?'active':'')+'" onclick="setFilter(\''+f.key+'\',this)">'+f.label+' ('+(counts[f.key]||0)+')</button>').join('');
}

function renderMustRead(){
    const c=document.getElementById('must-read-section');
    if(currentFilter!=='all'&&currentFilter!=='must-read'){c.innerHTML='';return;}
    const mr=allPapers.filter(p=>p.score>=8).slice(0,5);
    if(!mr.length){c.innerHTML='';return;}
    c.innerHTML='<div class="must-read-section"><div class="must-read-header"><h2>üî• Must Read Today</h2></div><div class="must-read-summary">'+(summaryData.daily_summary||'Top papers for serious researchers.')+'</div><div>'+mr.map(p=>renderPaper(p)).join('')+'</div></div>';
}

function renderPapers(){
    const c=document.getElementById('papers-list');
    const papers=currentFilter==='all'?filteredPapers.filter(p=>p.score<8):filteredPapers;
    if(!papers.length){c.innerHTML='<div class="no-results"><h3>No papers found</h3></div>';return;}
    c.innerHTML=papers.map(p=>renderPaper(p)).join('');
}

function renderPaper(p){
    const sc=p.score>=8?'high':p.score>=6?'medium':'low';
    const saved=readingList.includes(p.id);
    const exp=explanationsData[p.id];
    const cls=p.score>=8?'must-read':p.score>=6?'notable':'';
    let meta=[];
    if(p.institution)meta.push('<span class="paper-institution">üèõÔ∏è '+p.institution+'</span>');
    if(p.pubDateISO)meta.push('<span class="paper-date">üìÖ '+p.pubDateISO+'</span>');
    if(p.citations>0)meta.push('<span class="paper-citations">üìö '+p.citations+'</span>');
    if(p.upvotes>0)meta.push('<span>üëç '+p.upvotes+'</span>');
    if(p.github_stars>0)meta.push('<span>‚≠ê '+p.github_stars+'</span>');
    let tags='<span class="tag source '+(p.source||'').toLowerCase()+'" onclick="setFilter(\'source:'+p.source+'\')">'+p.source+'</span>';
    (p.tags||[]).forEach(t=>{tags+='<span class="tag" onclick="setFilter(\''+t+'\')">'+t+'</span>';});
    let contrib=p.key_contribution?'<div class="paper-contribution"><strong>Key:</strong> '+p.key_contribution+(p.why_it_matters?'<br><strong>Impact:</strong> '+p.why_it_matters:'')+'</div>':'';
    return '<div class="paper '+cls+'" data-id="'+p.id+'"><div class="paper-header"><div class="paper-title"><a href="'+p.link+'" target="_blank">'+p.title+'</a></div><span class="paper-score '+sc+'">'+p.score+'/10</span></div><div class="paper-meta">'+meta.join('')+'<span>'+p.authors+'</span></div>'+contrib+'<div class="paper-tags">'+tags+'</div><div class="paper-actions"><button class="action-btn save-btn '+(saved?'saved':'')+'" onclick="toggleSave(\''+p.id+'\')">'+(saved?'‚úì Saved':'üìö Save')+'</button><button class="action-btn" onclick="toggleSection(\''+p.id+'\',\'abstract\')">Abstract</button>'+(exp?'<button class="action-btn" onclick="toggleSection(\''+p.id+'\',\'prereqs\')">Prerequisites</button>':'')+(p.pdf_link?'<a href="'+p.pdf_link+'" target="_blank" class="action-btn pdf-btn">üìÑ PDF</a>':'')+(p.github_url?'<a href="'+p.github_url+'" target="_blank" class="action-btn">üíª Code</a>':'')+'</div><div class="paper-expandable" id="abstract-'+p.id+'"><div class="paper-abstract">'+(p.abstract||'No abstract.')+'</div></div>'+(exp?'<div class="paper-expandable" id="prereqs-'+p.id+'">'+renderPrereqs(exp)+'</div>':'')+'</div>';
}

function renderPrereqs(exp){
    const pr=exp.prerequisites||{};let h='';
    if(pr.difficulty_level)h+='<p><span class="difficulty-badge '+pr.difficulty_level+'">'+pr.difficulty_level+'</span>'+(pr.estimated_study_time?' ¬∑ '+pr.estimated_study_time:'')+'</p><br>';
    if(pr.core_concepts?.length){h+='<h4>üîë Concepts</h4><ul class="prereq-list">';pr.core_concepts.forEach(c=>{h+='<li><span class="prereq-name">'+c.name+'</span><br><span class="prereq-desc">'+(c.brief||'')+'</span></li>';});h+='</ul>';}
    if(pr.background_knowledge?.length){h+='<h4>üìö Background</h4><ul class="prereq-list">';pr.background_knowledge.forEach(b=>{h+='<li><span class="prereq-name">'+b.topic+'</span><br><span class="prereq-desc">'+(b.why_needed||'')+'</span></li>';});h+='</ul>';}
    return h||'<p>No data.</p>';
}

function renderTrends(){
    const c=document.getElementById('trends-list');
    const t=summaryData.weekly_trends;
    if(!t?.hot_topics?.length){c.innerHTML='<div class="loading">No trends</div>';return;}
    c.innerHTML=t.hot_topics.slice(0,5).map(x=>'<div class="trend-item"><div class="trend-topic">'+x.topic+' ('+x.paper_count+')</div><div class="trend-insight">'+x.insight+'</div></div>').join('');
}

function renderInstitutions(){
    const c=document.getElementById('institution-list');
    const inst=Object.entries(summaryData.institutions||{}).sort((a,b)=>b[1]-a[1]).slice(0,8);
    if(!inst.length){c.innerHTML='<li>No data</li>';return;}
    c.innerHTML=inst.map(([n,ct])=>'<li onclick="setFilter(\'inst:'+n+'\')"><span class="institution-name">'+n+'</span><span>'+ct+'</span></li>').join('');
}

function updateStats(){
    document.getElementById('stat-total').textContent=allPapers.length;
    document.getElementById('stat-mustread').textContent=allPapers.filter(p=>p.score>=8).length;
    document.getElementById('stat-notable').textContent=allPapers.filter(p=>p.score>=6&&p.score<8).length;
    document.getElementById('stat-code').textContent=allPapers.filter(p=>p.github_url).length;
}

function toggleSave(id){
    if(readingList.includes(id))readingList=readingList.filter(x=>x!==id);
    else readingList.push(id);
    localStorage.setItem('aiPapersReadingList',JSON.stringify(readingList));
    renderReadingList();buildFilters();applyFiltersAndRender();
}

function renderReadingList(){
    const c=document.getElementById('reading-list');
    document.getElementById('reading-count').textContent=readingList.length;
    if(!readingList.length){c.innerHTML='<div class="reading-list-empty">Click Save to add papers</div>';return;}
    const saved=allPapers.filter(p=>readingList.includes(p.id));
    c.innerHTML=saved.map(p=>'<div class="reading-list-item"><button class="remove-btn" onclick="toggleSave(\''+p.id+'\')">‚úï</button><a href="'+p.link+'" target="_blank">'+p.title+'</a></div>').join('');
}

function exportReadingList(){
    const saved=allPapers.filter(p=>readingList.includes(p.id));
    const txt=saved.map(p=>p.title+'\n'+p.link+'\n').join('\n');
    const b=new Blob([txt],{type:'text/plain'});
    const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='reading-list.txt';a.click();
}

function toggleSection(id,sec){const e=document.getElementById(sec+'-'+id);if(e)e.classList.toggle('show');}

document.addEventListener('keydown',e=>{
    if(e.target.tagName==='INPUT'){if(e.key==='Escape')e.target.blur();return;}
    const papers=document.querySelectorAll('.paper');
    if(e.key==='/'){e.preventDefault();document.getElementById('search-input').focus();}
    else if(e.key==='j'){e.preventDefault();selectedIndex=Math.min(selectedIndex+1,papers.length-1);highlight(papers);}
    else if(e.key==='k'){e.preventDefault();selectedIndex=Math.max(selectedIndex-1,0);highlight(papers);}
    else if(e.key==='o'&&selectedIndex>=0){const l=papers[selectedIndex]?.querySelector('.paper-title a');if(l)window.open(l.href,'_blank');}
    else if(e.key==='s'&&selectedIndex>=0){const id=papers[selectedIndex]?.dataset.id;if(id)toggleSave(id);}
});

function highlight(papers){
    papers.forEach((p,i)=>{p.style.outline=i===selectedIndex?'2px solid var(--accent-blue)':'none';});
    if(papers[selectedIndex])papers[selectedIndex].scrollIntoView({behavior:'smooth',block:'center'});
}

loadData();
</script>
</body>
</html>
