<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Papers Daily</title>
    <style>
        :root {
            --bg: #0d1117;
            --bg2: #161b22;
            --bg3: #21262d;
            --border: #30363d;
            --text: #e6edf3;
            --text2: #8b949e;
            --blue: #58a6ff;
            --green: #238636;
            --orange: #f0883e;
            --red: #da3633;
            --purple: #a371f7;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; }
        
        /* 3-Panel Layout */
        .app { display: flex; height: 100vh; }
        .papers-panel { width: 420px; border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .pdf-panel { flex: 1; display: flex; flex-direction: column; background: var(--bg2); }
        .chat-panel { width: 380px; border-left: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        
        /* Papers Panel */
        .panel-header { padding: 15px 20px; border-bottom: 1px solid var(--border); }
        .panel-header h1 { font-size: 1.3em; margin-bottom: 10px; }
        .search-box { width: 100%; padding: 10px 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.9em; }
        .search-box:focus { outline: none; border-color: var(--blue); }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 1px solid var(--border); background: var(--bg2); overflow-x: auto; }
        .tab { padding: 12px 16px; font-size: 0.85em; color: var(--text2); cursor: pointer; border-bottom: 2px solid transparent; white-space: nowrap; }
        .tab:hover { color: var(--text); }
        .tab.active { color: var(--blue); border-bottom-color: var(--blue); }
        .tab .count { background: var(--bg3); padding: 2px 8px; border-radius: 10px; font-size: 0.75em; margin-left: 6px; }
        .tab.active .count { background: var(--blue); color: white; }
        
        /* Paper List */
        .papers-list { flex: 1; overflow-y: auto; }
        .paper { padding: 14px 20px; border-bottom: 1px solid var(--border); cursor: pointer; }
        .paper:hover { background: var(--bg2); }
        .paper.selected { background: var(--bg3); border-left: 3px solid var(--blue); }
        .paper-title { font-size: 0.95em; font-weight: 600; margin-bottom: 6px; line-height: 1.4; }
        .paper-meta { font-size: 0.8em; color: var(--text2); display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 6px; }
        .paper-date { color: var(--orange); }
        .paper-score { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 600; }
        .paper-score.high { background: var(--green); color: white; }
        .paper-score.medium { background: var(--blue); color: white; }
        .paper-score.low { background: var(--bg3); color: var(--text2); }
        .paper-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
        .tag { font-size: 0.7em; padding: 2px 8px; background: var(--bg3); border-radius: 10px; color: var(--text2); }
        .paper-actions { display: flex; gap: 8px; margin-top: 10px; }
        .paper-btn { padding: 5px 10px; font-size: 0.75em; background: var(--bg3); border: 1px solid var(--border); border-radius: 4px; color: var(--text2); cursor: pointer; }
        .paper-btn:hover { background: var(--border); color: var(--text); }
        .paper-btn.primary { background: var(--blue); border-color: var(--blue); color: white; }
        .paper-btn.saved { background: var(--green); border-color: var(--green); color: white; }
        
        /* PDF Panel */
        .pdf-placeholder { flex: 1; display: flex; align-items: center; justify-content: center; color: var(--text2); text-align: center; padding: 40px; }
        .pdf-placeholder h2 { font-size: 1.2em; margin-bottom: 10px; color: var(--text); }
        .pdf-placeholder p { font-size: 0.9em; }
        .pdf-header { padding: 12px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--bg); }
        .pdf-title { font-size: 0.9em; font-weight: 600; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .pdf-links { display: flex; gap: 10px; }
        .pdf-links a { font-size: 0.8em; color: var(--blue); text-decoration: none; }
        .pdf-links a:hover { text-decoration: underline; }
        .pdf-frame { flex: 1; border: none; background: #525659; }
        
        /* Chat Panel */
        .chat-header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .chat-header h2 { font-size: 1em; }
        .ai-status { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
        .chat-context { padding: 10px 20px; background: var(--bg); border-bottom: 1px solid var(--border); font-size: 0.8em; color: var(--text2); }
        .chat-context strong { color: var(--purple); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; }
        .msg { margin-bottom: 16px; display: flex; gap: 10px; }
        .msg-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75em; flex-shrink: 0; }
        .msg.user .msg-avatar { background: var(--blue); }
        .msg.ai .msg-avatar { background: var(--purple); }
        .msg-body { flex: 1; }
        .msg-content { padding: 10px 14px; border-radius: 10px; font-size: 0.85em; line-height: 1.6; }
        .msg.user .msg-content { background: var(--blue); }
        .msg.ai .msg-content { background: var(--bg3); }
        .msg-time { font-size: 0.7em; color: var(--text2); margin-top: 4px; }
        .chat-input-area { padding: 15px 20px; border-top: 1px solid var(--border); }
        .quick-btns { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
        .quick-btn { padding: 5px 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 15px; font-size: 0.7em; cursor: pointer; color: var(--text2); }
        .quick-btn:hover { border-color: var(--purple); color: var(--text); }
        .chat-input-row { display: flex; gap: 8px; }
        .chat-input { flex: 1; padding: 10px 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.85em; resize: none; }
        .chat-input:focus { outline: none; border-color: var(--purple); }
        .chat-send { padding: 10px 16px; background: var(--purple); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: 500; }
        .chat-send:hover { opacity: 0.9; }
        .chat-send:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Loading & Typing */
        .loading { text-align: center; padding: 40px; color: var(--text2); }
        .typing-indicator { display: flex; gap: 4px; padding: 10px 14px; }
        .typing-indicator span { width: 8px; height: 8px; background: var(--text2); border-radius: 50%; animation: bounce 1.4s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-4px)} }
        
        /* Add Paper Modal */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg2); border-radius: 12px; padding: 25px; width: 90%; max-width: 500px; }
        .modal h2 { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.85em; color: var(--text2); margin-bottom: 6px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; background: var(--bg3); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.9em; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--purple); }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 6px; font-size: 0.9em; cursor: pointer; border: none; }
        .btn-primary { background: var(--purple); color: white; }
        .btn-secondary { background: var(--bg3); color: var(--text); }
        
        /* Responsive */
        @media (max-width: 1200px) { .chat-panel { width: 320px; } }
        @media (max-width: 1000px) { .chat-panel { display: none; } }
        @media (max-width: 800px) { .pdf-panel { display: none; } .papers-panel { width: 100%; } }
    </style>
</head>
<body>
<div class="app">
    <!-- Papers List Panel -->
    <div class="papers-panel">
        <div class="panel-header">
            <h1>üî¨ AI Papers Daily</h1>
            <input type="text" class="search-box" id="search" placeholder="Search papers..." oninput="filterPapers()">
        </div>
        <div class="tabs" id="tabs"></div>
        <div class="papers-list" id="papers-list">
            <div class="loading">Loading papers...</div>
        </div>
        <div style="padding:10px 20px;border-top:1px solid var(--border)">
            <button class="paper-btn" style="width:100%" onclick="openAddModal()">‚ûï Add Paper</button>
        </div>
    </div>
    
    <!-- PDF Viewer Panel -->
    <div class="pdf-panel" id="pdf-panel">
        <div class="pdf-placeholder" id="pdf-placeholder">
            <div>
                <h2>üìÑ Select a Paper</h2>
                <p>Click "Open PDF" on any paper to view it here</p>
            </div>
        </div>
    </div>
    
    <!-- AI Chat Panel -->
    <div class="chat-panel">
        <div class="chat-header">
            <div class="ai-status"></div>
            <h2>ü§ñ Ask AI</h2>
        </div>
        <div class="chat-context" id="chat-context">Select a paper to ask questions about it</div>
        <div class="chat-messages" id="chat-messages">
            <div class="msg ai">
                <div class="msg-avatar">ü§ñ</div>
                <div class="msg-body">
                    <div class="msg-content">Hi! Open a paper and I'll help you understand it. I can explain concepts, summarize sections, or answer any questions about the research.</div>
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <div class="quick-btns">
                <span class="quick-btn" onclick="askAI('Summarize this paper in 3 bullet points')">Summarize</span>
                <span class="quick-btn" onclick="askAI('What is the key contribution?')">Key contribution</span>
                <span class="quick-btn" onclick="askAI('Explain the methodology')">Methodology</span>
                <span class="quick-btn" onclick="askAI('What are the limitations?')">Limitations</span>
            </div>
            <div class="chat-input-row">
                <textarea class="chat-input" id="chat-input" rows="1" placeholder="Ask about this paper..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}"></textarea>
                <button class="chat-send" id="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Paper Modal -->
<div class="modal-overlay" id="add-modal" onclick="if(event.target===this)closeAddModal()">
    <div class="modal">
        <h2>‚ûï Add Paper</h2>
        <form onsubmit="saveCustomPaper(event)">
            <div class="form-group">
                <label>Title *</label>
                <input type="text" id="add-title" required placeholder="Attention Is All You Need">
            </div>
            <div class="form-group">
                <label>URL *</label>
                <input type="url" id="add-url" required placeholder="https://arxiv.org/abs/1706.03762">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Authors</label>
                    <input type="text" id="add-authors" placeholder="Vaswani et al.">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="add-date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Score (1-10)</label>
                    <input type="number" id="add-score" min="1" max="10" placeholder="8">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="add-category">
                        <option value="classic">üìú Classic</option>
                        <option value="toread">üìñ To Read</option>
                        <option value="research">üî¨ Research</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Tags (comma separated)</label>
                <input type="text" id="add-tags" placeholder="transformers, attention">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
// === STATE ===
let allPapers = [];
let customPapers = JSON.parse(localStorage.getItem('customPapers') || '[]');
let savedPapers = JSON.parse(localStorage.getItem('savedPapers') || '[]');
let currentTab = 'today';
let selectedPaper = null;
let chatHistory = [];

// === LOAD DATA ===
async function loadData() {
    try {
        const res = await fetch('papers.json');
        const data = await res.json();
        allPapers = data.papers || [];
        renderTabs();
        filterPapers();
    } catch (e) {
        document.getElementById('papers-list').innerHTML = '<div class="loading">Failed to load papers</div>';
        renderTabs();
    }
}

// === TABS ===
function renderTabs() {
    const counts = {
        today: allPapers.length,
        'must-read': allPapers.filter(p => p.score >= 8).length,
        saved: savedPapers.length,
        'my-papers': customPapers.length
    };
    
    const tabs = [
        { id: 'today', label: 'Today', count: counts.today },
        { id: 'must-read', label: 'üî• Must Read', count: counts['must-read'] },
        { id: 'saved', label: 'üìö Saved', count: counts.saved },
        { id: 'my-papers', label: 'üìÅ My Papers', count: counts['my-papers'] }
    ];
    
    document.getElementById('tabs').innerHTML = tabs.map(t => 
        `<div class="tab ${currentTab === t.id ? 'active' : ''}" onclick="switchTab('${t.id}')">${t.label}<span class="count">${t.count}</span></div>`
    ).join('');
}

function switchTab(tab) {
    currentTab = tab;
    renderTabs();
    filterPapers();
}

// === FILTER & RENDER ===
function filterPapers() {
    const query = document.getElementById('search').value.toLowerCase();
    let papers = [];
    
    if (currentTab === 'today') {
        papers = allPapers;
    } else if (currentTab === 'must-read') {
        papers = allPapers.filter(p => p.score >= 8);
    } else if (currentTab === 'saved') {
        papers = [...customPapers, ...allPapers].filter(p => savedPapers.includes(p.id));
    } else if (currentTab === 'my-papers') {
        papers = customPapers;
    }
    
    if (query) {
        papers = papers.filter(p => 
            p.title?.toLowerCase().includes(query) || 
            p.authors?.toLowerCase().includes(query) ||
            p.tags?.some(t => t.toLowerCase().includes(query))
        );
    }
    
    // Sort by score then date
    papers.sort((a, b) => (b.score || 0) - (a.score || 0));
    
    renderPapers(papers);
}

function renderPapers(papers) {
    const container = document.getElementById('papers-list');
    
    if (!papers.length) {
        container.innerHTML = '<div class="loading">No papers found</div>';
        return;
    }
    
    container.innerHTML = papers.map(p => {
        const scoreClass = p.score >= 8 ? 'high' : p.score >= 6 ? 'medium' : 'low';
        const isSaved = savedPapers.includes(p.id);
        const isSelected = selectedPaper?.id === p.id;
        const pdfUrl = p.pdf_link || (p.link?.includes('arxiv.org/abs/') ? p.link.replace('/abs/', '/pdf/') + '.pdf' : null);
        
        return `
        <div class="paper ${isSelected ? 'selected' : ''}" onclick="selectPaper('${p.id}')">
            <div class="paper-title">${p.title}</div>
            <div class="paper-meta">
                <span class="paper-date">üìÖ ${p.pubDate || p.date || 'Unknown'}</span>
                <span>${p.authors || 'Unknown'}</span>
                ${p.institution ? `<span>üèõÔ∏è ${p.institution}</span>` : ''}
                <span class="paper-score ${scoreClass}">${p.score || '?'}/10</span>
            </div>
            ${p.tags?.length ? `<div class="paper-tags">${p.tags.slice(0, 4).map(t => `<span class="tag">${t}</span>`).join('')}</div>` : ''}
            <div class="paper-actions">
                ${pdfUrl ? `<button class="paper-btn primary" onclick="event.stopPropagation();openPDF('${p.id}')">üìÑ Open PDF</button>` : ''}
                <button class="paper-btn ${isSaved ? 'saved' : ''}" onclick="event.stopPropagation();toggleSave('${p.id}')">${isSaved ? '‚úì Saved' : 'Save'}</button>
                <a href="${p.link}" target="_blank" class="paper-btn" onclick="event.stopPropagation()">‚Üó Link</a>
                ${p.isCustom ? `<button class="paper-btn" onclick="event.stopPropagation();deleteCustom('${p.id}')" style="color:var(--red)">üóëÔ∏è</button>` : ''}
            </div>
        </div>`;
    }).join('');
}

// === PAPER SELECTION ===
function selectPaper(id) {
    const allPapersWithCustom = [...customPapers, ...allPapers];
    selectedPaper = allPapersWithCustom.find(p => p.id === id);
    
    if (selectedPaper) {
        document.getElementById('chat-context').innerHTML = `üìÑ <strong>${selectedPaper.title}</strong>`;
        chatHistory = [];
        document.getElementById('chat-messages').innerHTML = `
            <div class="msg ai">
                <div class="msg-avatar">ü§ñ</div>
                <div class="msg-body">
                    <div class="msg-content">I'm ready to discuss "<strong>${selectedPaper.title}</strong>". What would you like to know?</div>
                </div>
            </div>`;
    }
    
    filterPapers();
}

// === PDF VIEWER ===
function openPDF(id) {
    selectPaper(id);
    const paper = selectedPaper;
    if (!paper) return;
    
    let pdfUrl = paper.pdf_link;
    if (!pdfUrl && paper.link?.includes('arxiv.org/abs/')) {
        pdfUrl = paper.link.replace('/abs/', '/pdf/') + '.pdf';
    }
    
    if (!pdfUrl) {
        alert('No PDF available for this paper');
        return;
    }
    
    document.getElementById('pdf-panel').innerHTML = `
        <div class="pdf-header">
            <div class="pdf-title">${paper.title}</div>
            <div class="pdf-links">
                <a href="${pdfUrl}" target="_blank">Open in new tab ‚Üó</a>
                <a href="${paper.link}" target="_blank">Paper page ‚Üó</a>
            </div>
        </div>
        <iframe class="pdf-frame" src="${pdfUrl}"></iframe>
    `;
}

// === SAVE/DELETE ===
function toggleSave(id) {
    if (savedPapers.includes(id)) {
        savedPapers = savedPapers.filter(x => x !== id);
    } else {
        savedPapers.push(id);
    }
    localStorage.setItem('savedPapers', JSON.stringify(savedPapers));
    renderTabs();
    filterPapers();
}

function deleteCustom(id) {
    if (!confirm('Delete this paper?')) return;
    customPapers = customPapers.filter(p => p.id !== id);
    localStorage.setItem('customPapers', JSON.stringify(customPapers));
    renderTabs();
    filterPapers();
}

// === ADD PAPER MODAL ===
function openAddModal() { document.getElementById('add-modal').classList.add('show'); }
function closeAddModal() { document.getElementById('add-modal').classList.remove('show'); }

function saveCustomPaper(e) {
    e.preventDefault();
    
    const paper = {
        id: 'custom-' + Date.now(),
        title: document.getElementById('add-title').value,
        link: document.getElementById('add-url').value,
        pdf_link: document.getElementById('add-url').value.includes('arxiv.org/abs/') 
            ? document.getElementById('add-url').value.replace('/abs/', '/pdf/') + '.pdf' 
            : null,
        authors: document.getElementById('add-authors').value || 'Unknown',
        pubDate: document.getElementById('add-date').value || new Date().toISOString().split('T')[0],
        score: parseInt(document.getElementById('add-score').value) || 7,
        category: document.getElementById('add-category').value,
        tags: document.getElementById('add-tags').value.split(',').map(t => t.trim()).filter(t => t),
        isCustom: true
    };
    
    customPapers.unshift(paper);
    localStorage.setItem('customPapers', JSON.stringify(customPapers));
    
    closeAddModal();
    document.querySelector('#add-modal form').reset();
    switchTab('my-papers');
}

// === AI CHAT ===
function askAI(text) {
    document.getElementById('chat-input').value = text;
    sendMessage();
}

async function sendMessage() {
    const input = document.getElementById('chat-input');
    const msg = input.value.trim();
    if (!msg || !selectedPaper) {
        if (!selectedPaper) alert('Please select a paper first');
        return;
    }
    
    // Add user message
    addMessage('user', msg);
    input.value = '';
    
    // Show typing indicator
    const typingId = showTyping();
    
    // Build context for AI
    const context = {
        paper: {
            title: selectedPaper.title,
            authors: selectedPaper.authors,
            abstract: selectedPaper.abstract,
            score: selectedPaper.score,
            tags: selectedPaper.tags,
            key_contribution: selectedPaper.key_contribution
        },
        question: msg,
        history: chatHistory.slice(-6) // Last 3 exchanges
    };
    
    try {
        // Try API call
        const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(context)
        });
        
        if (res.ok) {
            const data = await res.json();
            removeTyping(typingId);
            addMessage('ai', data.response);
            chatHistory.push({ role: 'user', content: msg }, { role: 'ai', content: data.response });
            return;
        }
    } catch (e) {
        console.log('API unavailable, using local response');
    }
    
    // Fallback to local response
    removeTyping(typingId);
    const response = getLocalResponse(msg);
    addMessage('ai', response);
    chatHistory.push({ role: 'user', content: msg }, { role: 'ai', content: response });
}

function addMessage(role, content) {
    const container = document.getElementById('chat-messages');
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    container.innerHTML += `
        <div class="msg ${role}">
            <div class="msg-avatar">${role === 'ai' ? 'ü§ñ' : 'üë§'}</div>
            <div class="msg-body">
                <div class="msg-content">${content}</div>
                <div class="msg-time">${time}</div>
            </div>
        </div>`;
    
    container.scrollTop = container.scrollHeight;
}

function showTyping() {
    const id = 'typing-' + Date.now();
    const container = document.getElementById('chat-messages');
    container.innerHTML += `
        <div class="msg ai" id="${id}">
            <div class="msg-avatar">ü§ñ</div>
            <div class="msg-body">
                <div class="typing-indicator"><span></span><span></span><span></span></div>
            </div>
        </div>`;
    container.scrollTop = container.scrollHeight;
    return id;
}

function removeTyping(id) {
    document.getElementById(id)?.remove();
}

function getLocalResponse(msg) {
    const p = selectedPaper;
    const m = msg.toLowerCase();
    
    if (m.includes('summar')) {
        return `<strong>Summary of "${p.title}":</strong><br><br>
            ${p.key_contribution || p.abstract?.slice(0, 300) || 'This paper presents research in ' + (p.tags?.[0] || 'AI/ML') + '.'}<br><br>
            <strong>Score:</strong> ${p.score}/10<br>
            <strong>Authors:</strong> ${p.authors || 'Unknown'}`;
    }
    
    if (m.includes('key') || m.includes('contribution') || m.includes('novel')) {
        return p.key_contribution 
            ? `<strong>Key Contribution:</strong><br><br>${p.key_contribution}`
            : `The key contribution isn't extracted yet. Based on the title "${p.title}", this paper likely focuses on ${p.tags?.join(', ') || 'machine learning research'}.`;
    }
    
    if (m.includes('method') || m.includes('how')) {
        return `For detailed methodology, I'd recommend checking the PDF (sections 3-4 typically cover methods).<br><br>
            Based on the paper's focus on ${p.tags?.[0] || 'AI'}, it likely involves ${p.tags?.includes('transformers') ? 'attention mechanisms and transformer architectures' : 'neural network approaches'}.`;
    }
    
    if (m.includes('limit') || m.includes('weakness')) {
        return p.limitations 
            ? `<strong>Limitations:</strong><br><br>${p.limitations}`
            : `The specific limitations aren't extracted. Common limitations in ${p.tags?.[0] || 'ML'} papers include computational costs, dataset biases, and generalization concerns. Check the paper's discussion section for details.`;
    }
    
    if (m.includes('why') || m.includes('important') || m.includes('matter')) {
        return p.why_it_matters 
            ? `<strong>Why it matters:</strong><br><br>${p.why_it_matters}`
            : `This paper scored ${p.score}/10 on importance. ${p.score >= 8 ? 'High scores indicate significant novelty or impact.' : p.score >= 6 ? 'A solid contribution to the field.' : 'Incremental but potentially useful work.'}`;
    }
    
    // Default contextual response
    return `I can help you understand "<strong>${p.title}</strong>".<br><br>
        Try asking about:<br>
        ‚Ä¢ The key contribution<br>
        ‚Ä¢ Methodology and approach<br>
        ‚Ä¢ Limitations<br>
        ‚Ä¢ Why this paper matters<br><br>
        Or ask any specific question about the content!`;
}

// === INIT ===
loadData();
</script>
</body>
</html>
